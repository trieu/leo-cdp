<div class="container-fluid">

    <div class="row">
        <div class="col-lg-10">
            <h4 class="page-header" id="page_breadcrumb" > </h4>
        </div>
        <div class="col-lg-2 text-center" style="padding: 10px">
        	<button type="button" class="btn btn-success" onclick="" > Save </button>
        	<button type="button" class="btn btn-secondary" onclick="" > Cancel </button>
        </div>
    </div>

    <div class="row gridholder" >
        <div class="col-lg-12">
        	<div class="row">
		       	 	<div id="journeyFlowChart" class="experience_journey_flow" style="height:420px;"></div>
		    </div>
            <div class="table-responsive">
                <div id="media_channels_table"></div>
            </div>
        </div>
    </div>

</div>

<script>
    var initMediaJourneyMap = initMediaJourneyMap || function() {
    	LeoAdminApiUtil.getSecuredData('/cdp/journeymap/get', { "id" : "" }, function(json){ 
	   		 console.log(json.data);	
	   		 return;
	   		 var eventFunnelStages = json.data['event_retail'];
	   		 var customerFunnelStages = json.data['customer_retail'];
	   		 var behavioralMetricsData = json.data['behavioral_metrics'];
	   		 var positiveNumbers = [];
	   		 for(var i = 0; i< 100; i++){
	   			positiveNumbers[i] = i;
	   		 }
	   		 
	   		 $("#media_channels_table").jsGrid({
	   		    width: "100%",
	   		    height: "auto",
	
	   		    inserting: true,
	   		    editing: true,
	   		    sorting: true,
	   		    paging: false,
	   		    
	   		    deleteConfirm: function(item) {
	   	            return "The event \"" + item.eventName + "\" will be removed. Are you sure?";
	   	        },
	
	   		    data: behavioralMetricsData,
	   		    
	   		    onItemInserting: function(args) {
	   		    	//console.log(args.item)
	   		    	
	   		    	// TODO Ajax submit data to backend here
	   		    	setTimeout(function(){
	   		    		args.item.id = "";
	   		    		//console.log(behavioralMetricsData)
	   		    	},1000);
	   		    	
	   		    },      
	   		    onItemInserted: function(args) {
	   		    	//console.log(args.item)
	   		    	//console.log(behavioralMetricsData)
	   		    }, 
	   		    onItemDeleting: function(args) {
	   		        console.log(args.item)
	   		    },
	
	   		    fields: [
	   		        { name: "eventName", title : "Behavioral Event Metric", type: "text", validate: "required" },
	   		        { name: "score", title : "Score", type: "select", width: 40, validate: "required", items: positiveNumbers },
	   		        { name: "eventFunnelStageId", title : "Event Funnel Stage", type: "select", items: eventFunnelStages, valueField: "id", textField: "name" },
	   		        { name: "customerFunnelStageId", title : "Customer Funnel Stage", type: "select", items: customerFunnelStages, valueField: "id", textField: "name" },
	   		        { type: "control" , width: 50}
	   		    ]
	   		});  
	   	});
        //renderJourneyFlowChart()
    }    
    
    function renderJourneyFlowChart(metricName, journeyStages, journeyStageMetrics, mediaChannelMap, journeyLinks) {
        var metricName = 'Reach'
        var journeyStages = ['Google Search', 'Facebook Group', 'YouTube channel']
        var journeyStageMetrics = { 'Google Search' : 'pageview' };
        var journeyNodes = [{
            id: 0,
            name: "Google Search"
        }];

        var configSankey = {
            margin: {
                top: 10,
                left: 10,
                right: 10,
                bottom: 10
            },
            nodes: {
                dynamicSizeFontNode: {
                    enabled: true,
                    minSize: 14,
                    maxSize: 30
                },
                fontSize: 14, // if dynamicSizeFontNode not enabled
                draggableX: false, // default [ false ]
                draggableY: true, // default [ true ]
                colors: d3.scaleOrdinal(d3.schemeCategory10)
            },
            links: {
                formatValue: function (name, val) {
                    //console.log('formatValue ' + name)
                    var label = journeyStageMetrics[name] ? journeyStageMetrics[name] : metricName
                    return d3.format(",.0f")(val) + ' ' + label;
                },
                unit: metricName // if not set formatValue function
            },
            tooltip: {
                infoDiv: true, // if false display default tooltip
                labelSource: 'Input:',
                labelTarget: 'Output:'
            }
        }

        var objSankey = sk.createSankey('#journeyFlowChart', configSankey, {
            nodes: journeyNodes,
            links: journeyLinks
        });
    }
</script>