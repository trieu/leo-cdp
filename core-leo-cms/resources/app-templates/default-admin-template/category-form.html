<div class="container-fluid" id="category_form">

    <!-- MAIN BODY here -->
    <div class="row">
        <div class="col-lg-12">
            <h3 class="page-header">Category Information </h3>
        </div>
    </div>

    <!-- MAIN BODY here -->
    <div class="row">
        <div class="col-lg-9">

            <fieldset>

                <div class="form-group">
                    <label> Category Name</label>
                    <input data-validation-length="min4" type="text" class="form-control" placeholder="Enter Category Name"
                        name="name" autocomplete="nope" autocorrect="off" autocapitalize="none" spellcheck="false">
                </div>
                <div>
                    <div id="error-on-save" class="alert alert-danger" style="display: none;"></div>
                    <div class="action-div row-centered ">
                        <a href="javascript:saveCategoryInfo()" class="btn btn-primary">
                            <i class="fa fa-fw fa-check"></i> Save
                        </a>
                        <button type="button" class="btn btn-info" onclick="history.back()">Cancel</button>

                        <!-- TODO verify before delete category -->
                        <button type="button" class="btn btn-danger" style="display:none" onclick="deleteCategoryInfo()">Delete</button>
                    </div>
                </div>
            </fieldset>

        </div>

    </div>
</div>

<hr>

<script>
    var categoryModel = false;

    function loadDataCategoryInfo(key) {
        var urlStr = baseAdminApi + '/category/get-info';
        LeoCmsApiUtil.callPostAdminApi(urlStr, {
            'key': key || 'newcategory'
        }, function (json) {
            if (json.errorCode === 0 && json.errorMessage === '') {
                if (json.data) {
                    categoryModel = json.data;
                    var date = LeoCmsApiUtil.formater.toDateString(categoryModel.creationTime);

                    var node = $('#category_form');
                    if (typeof categoryModel.key === 'string') {
                        //update
                    } else {
                        // create
                    }
                    node.find('input[name="name"]').val(categoryModel.name);

                    //TODO customData
                }
            }
        });
    }

    function saveCategoryInfo() {
        var node = $('#category_form');
        categoryModel.name = node.find('input[name="name"]').val();

        //TODO more data field here

        var urlStr = baseAdminApi + '/category/create-new';
        if (typeof categoryModel.key === 'string') {
            urlStr = baseAdminApi + '/category/update-info';
        }

        var onSaveOk = function (data) {
            console.log('=====> saveCategoryInfo ', data);
            setTimeout(function () {
                location.href = '/';
            }, 500);
        }

        LeoCmsApiUtil.callPostAdminApi(urlStr, categoryModel, function (json) {
            if (json.errorCode === 0 && json.errorMessage === '') {
                if (json.data === '') {
                    $('#error-on-save').html('Data is not valid !').show().delay(6000).fadeOut('slow');
                } else {
                    onSaveOk(json.data);
                }
            } else {
                $('#error-on-save').html(json.errorMessage).show().delay(6000).fadeOut('slow');
                LeoCmsApiUtil.logErrorPayload(json);
            }
        });
        console.log(categoryModel);
    }

    function deleteCategoryInfo() {
        var result = confirm("Do you want to delete " + categoryModel.name + " ?");
        if (result) {
            var onSaveOk = function (data) {
                console.log('=====> deleteCategoryInfo ', data);
                setTimeout(function () {
                    location.href = '/';
                }, 500);
            }
            var urlStr = baseAdminApi + '/category/delete';
            LeoCmsApiUtil.callPostAdminApi(urlStr, categoryModel, function (json) {
                if (json.errorCode === 0 && json.errorMessage === '') {
                    if (json.data === '') {
                        $('#error-on-save').html('Data is not valid !').show().delay(6000).fadeOut('slow');
                    } else {
                        onSaveOk(json.data);
                    }
                } else {
                    $('#error-on-save').html(json.errorMessage).show().delay(6000).fadeOut('slow');
                    LeoCmsApiUtil.logErrorPayload(json);
                }
            });
        }
    }
</script>