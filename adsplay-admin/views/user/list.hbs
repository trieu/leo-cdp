<div class="row">
    <div class="col-lg-12">
        <h3 class="page-header">
            {{dashboard_title}}
        </h3>
    </div>
</div>

{{#if isSuperAdminGroup }}
    <div class="row">
        <div class="col-lg-12">
            <div class="table-responsive" id="user-list">
            </div>
        </div>
    </div>
{{/if}}



<script>
    $(function () {

        Handlebars.registerHelper('formatCurrency', function(value) { return value.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"); });

        function list_html (data){
            var dataList = {user: data};

            var table = '\
                <table class="table table-hover table-striped" id="tab-user"> \
                	<thead> \
		                <tr> \
		                    <th>ID</th> \
		                    <th>User Name</th> \
		                    <th>Email</th> \
		                    <th>Roles</th> \
		                    <th>Gender</th> \
		                    <th>Status</th> \
		                </tr> \
                    </thead> \
                    <tbody> \
                    </tbody> \
                </table> \
            ';
            $("#user-list").empty();
            $("#user-list").append(table)
            
            if (!data || data.length == 0) {
                $('#tab-user').find('tbody').empty().append('<tr><td colspan="8" style="text-align: center">No record found!</td></tr>');
            } else {
                var source = $("#tab-list").html();
                var template = Handlebars.compile(source);
                var htmlTable = template(dataList);

                $('#tab-user').find('tbody').empty().append(htmlTable);
            }
        }

        function render_list(){
            $.ajax({
                url: '/user/find',
                type: "GET",
                contentType: "application/json",
                dataType:'json',
                beforeSend: function(){
                    $('#wrapper').append('<div class="loader"></div>');
                },
                success: function(data){
                    $('.loader').remove();
                    list_html(data);
                    selected_status();
                    var table = $("#tab-user").DataTable({
                        "pageLength": 25,
                        "order": [[0,'desc']]
                    });

                    $("#filter-status").change(function(){
			        	table.search($(this).val()).draw();
			        });

                }
            });
        }

        function render_status(){
            var statusArr = {0: "disable", 1: "enable", 2: "banner"};
            var select = '<select class="form-control user-status">';
            for(var i in statusArr){
                select+='<option value='+i+'>'+statusArr[i]+'</option>'
            }
            select+='</select>';

            return select;
        }

        function selected_status(){
            var select = render_status();
            $('[data-status]').each(function(){
                $select = $(select);
                $select.val($(this).attr('data-status'));
                $(this).append($select);
            });
        }

        $(document).on('change', '.user-status', function(){

            $tr = $(this).parents('tr');
            $id = $tr.find('[data-id]');
            var id = $id.attr('data-id');
            var status = $(this).val();
            $.ajax({
                url: '/user/update/'+id+'/'+status,
                type: "GET",
                contentType: "application/json",
                dataType: 'json',
                success: function(data){
                    console.log(data)
                }
            });

        });

        render_list();

    });

</script>

<script id="tab-list" type="text/x-handlebars">
    \{{#each user}}
        <tr >
            <td data-id="\{{_id}}">\{{_id}}</td>
            <td><a href="/user/find/\{{_id}}" title="\{{username}}">\{{username}}</a></td>
            <td title="\{{email}}">\{{email}}</td>
            <td>\{{roles}}</td>
            <td>\{{gender}}</td>
            <td data-status="\{{status}}"></td>
        </tr>
    \{{/each}}
</script>
