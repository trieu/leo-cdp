<script src="js/validatr.min.js"></script>
<style type="text/css">
	#plt_form table td{
		position: relative;
	}
	.validatr-message{
		padding: 1px 5px !important;
		font-size: 11px;
		max-width: 160;
		z-index: 1;
	}
</style>
<div class="row">
    <div class="col-lg-12">
        <ol class="breadcrumb">
        </ol>
        <h1 class="page-header">
            All Placements
        </h1>
    </div>
</div>

<!-- <a href="/placement/new/"><i class="fa fa-fw fa-list"></i> New Placement</a> -->

<p>
	<button type="button" class="btn btn-primary" id="new-placement">
		<i class="fa fa-fw fa-list"></i> New Placement
	</button>
</p>

<div class="row">
	<div class="col-lg-12">
		<div class="table-responsive">
			<table class="table table-bordered table-hover table-striped">
				<thead>
					<tr>
						<th>ID</th>
						<th>Name</th>
						<th>Publisher</th>
						<th>Type</th>
						<th>Width</th>
						<th>Height</th>
						<th>Updated Date</th>
						<th></th>
					</tr>
				</thead>
				<tbody id="plt_container">
					{{#each placements}}
					<tr>
						<td class="plt_id">{{id}}</td>
						<td class="plt_name">{{name}}</td>
						<td class="plt_publisher">{{publisher}}</td>
						<td class="plt_type">{{type}}</td>
						<td class="plt_width">{{width}}</td>
						<td class="plt_height">{{height}}</td>
						<td class="plt_updatedDate">{{updatedDate}}</td>
						<td width="40px">
							<button type="button" id="{{id}}" class="btn btn-primary btn-xs">
								<i class="fa fa-pencil"></i>
							</button>
						</td>
					</tr>
					{{/each}}
				</tbody>
            </table>
		</div>
	</div>
</div>

<!-- modal form popup -->
<div id="modal-placement" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Form Placement</h4>
      </div>
      <div class="modal-body">
      	<form id="plt_form">
      		<table class="table table-bordered table-hover table-striped">
				<tbody>
					<input type="hidden" class="form-control" name="plt_id">
					<tr>
						<td><strong>Name</strong></td>
						<td>
							<input type="text" class="form-control" name="plt_name" data-minLength="10" required>
						</td>
					</tr>
					<tr>
						<td><strong>Publisher</strong></td>
						<td>
							<input type="text" class="form-control" name="plt_publisher" required>
						</td>
					</tr>
					<tr>
						<td><strong>Type</strong></td>
						<td>
							<input type="number" class="form-control" name="plt_type" required>
						</td>
					</tr>
					<tr>
						<td><strong>Width</strong></td>
						<td>
							<input type="number" class="form-control" name="plt_width" required>
						</td>
					</tr>
					<tr>
						<td><strong>Height</strong></td>
						<td>
							<input type="number" class="form-control" name="plt_height" required>
						</td>
					</tr>
					<tr>
						<td><strong>Updated</strong></td>
						<td>
							<input type="date" class="form-control" name="plt_updatedDate" required>
						</td>
					</tr>
				</tbody>
	        </table>
	        <div class="text-right">
	        	<button type="submit" class="btn btn-primary" id="plt_submit">
					OK
				</button>
	        </div>
      	</form>
        
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
	var plt_form = $('#plt_form');

	//using validatr.js
	plt_form.validatr({
		location: 'left',
		//showall: true
	});
	//custom valid
	plt_form.validatr('addTest', {
		minLength: function (el) {
			var valid = false;
			var min = parseInt($(el).attr('data-minLength'));
			if($(el).val().length >= min){
				valid = true;
			}
			return {
				valid: valid,
				message: 'Length >= ' + min
			};
		},
		maxLength: function (el) {
			var valid = false;
			var max = parseInt($(el).attr('data-maxLength'));
			if($(el).val().length <= max){
				valid = true;
			}
			return {
				valid: valid,
				message: 'Length <= ' + max
			};
		}
	});
	//end setup validatr.js


	$('#new-placement').click(function(){
		$('#modal-placement').modal('show');
		plt_form.find('input').val("");
		console.log(plt_form.find('input'))
	});

	plt_form.submit(function(e) {
		e.preventDefault();
		//check valid form
		if (! $.validatr.validateForm(plt_form)) {
			return false;
		}

		var data = plt_data(plt_form);
		console.log(data);
		$.ajax({
			url: '/placement/save/',
			type: "POST",
			contentType: "application/json",
			dataType:'json',
			data: data,
			beforeSend: function(){
				$('#wrapper').append('<div class="loader"></div>');
			},
			success: function(data){
				$('.loader').remove();
				$('#modal-placement').modal('hide');

				$("#plt_container").append('\
					<tr> \
						<td class="plt_id">'+data.id+'</td> \
						<td class="plt_name">'+data.name+'</td> \
						<td class="plt_publisher">'+data.publisher+'</td> \
						<td class="plt_type">'+data.type+'</td> \
						<td class="plt_width">'+data.width+'</td> \
						<td class="plt_height">'+data.height+'</td> \
						<td class="plt_updatedDate">'+data.updatedDate+'</td> \
						<td width="40px"> \
							<button type="button" id="'+data.id+'" class="btn btn-primary btn-xs"> \
								<i class="fa fa-pencil"></i> \
							</button> \
						</td> \
					</tr> \
				')
			}
		});
	});

	function plt_data(form){
		var data = {};
			data["id"] = form.find('[name="plt_id"]').val();
			data["name"] = form.find('[name="plt_name"]').val();
			data["publisher"] = form.find('[name="plt_publisher"]').val();
			data["type"] = form.find('[name="plt_type"]').val();
			data["width"] = form.find('[name="plt_width"]').val();
			data["height"] = form.find('[name="plt_height"]').val();
			data["updatedDate"] = form.find('[name="plt_updatedDate"]').val();
		return JSON.stringify(data);	
	}

</script>